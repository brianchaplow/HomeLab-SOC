# Fluent Bit Configuration - QNAP NAS
# Location: /share/Container/SOC/ingestion/fluentbit/fluent-bit.conf
# Purpose: Collect Suricata, Zeek, and syslog data for OpenSearch

[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Parsers_File /fluent-bit/etc/parsers.conf
    Parsers_File /fluentbit/parsers.conf

# INPUT: Zeek logs
[INPUT]
    Name              tail
    Path              /logs/zeek/*.log
    Tag               zeek.*
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /fluentbit/state/zeek.db

# INPUT: Suricata eve.json (IDS alerts and flow data)
[INPUT]
    Name              tail
    Path              /logs/suricata/eve.json
    Tag               suricata.eve
    Parser            json
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /fluentbit/state/suricata_eve.db

# INPUT: Syslog (TCP)
[INPUT]
    Name            syslog
    Mode            tcp
    Listen          0.0.0.0
    Port            5514
    Tag             syslog.tcp
    Parser          syslog-rfc3164

# INPUT: Syslog (UDP)
[INPUT]
    Name            syslog
    Mode            udp
    Listen          0.0.0.0
    Port            5514
    Tag             syslog.udp
    Parser          syslog-rfc3164

# FILTER: Tag Zeek records
[FILTER]
    Name            modify
    Match           zeek.*
    Add             source zeek

# FILTER: Tag Suricata records
[FILTER]
    Name            modify
    Match           suricata.eve
    Add             source suricata

# FILTER: Tag syslog records
[FILTER]
    Name            modify
    Match           syslog.*
    Add             source syslog

# OUTPUT: OpenSearch
[OUTPUT]
    Name            es
    Match           *
    Host            192.168.50.10
    Port            9200
    HTTP_User       admin
    HTTP_Passwd     ${OPENSEARCH_PASSWORD}
    Index           fluentbit-default
    Logstash_Format Off
    Suppress_Type_Name On
    tls             On
    tls.verify      Off
